function allowDrop(e){e.preventDefault()}function drag(e){for(e.dataTransfer.setData("text",e.target.id),i=0;i<13;i++){var t=document.getElementById(player_positions[i]);t.style.borderColor="#12FF01",t.style.backgroundColor="rgba(186,255,191,0.5)"}}function dragstop(){for(i=0;i<13;i++){var e=document.getElementById(player_positions[i]);e.style.borderColor="#aaaaaa",e.style.backgroundColor="transparent"}}function drop(e){if(e.preventDefault(),e.target.hasChildNodes()){if(3!=e.target.childNodes[0].nodeType)return;e.target.removeChild(e.target.firstChild)}if("cardl"==e.target.className){var t=e.dataTransfer.getData("text");e.target.appendChild(document.getElementById(t))}}function setupGame(){console.log("Welcome to OFCP-AI, an application by Alastair Kerr!"),console.log("Player first: "+playerFirst);var e=document.getElementById("playButton");if(e.onclick=function(){e.innerHTML="Next",POST_reqwest(initial_5)},"False"==playerFirst){e.innerHTML="Next",e.style.display="none",POST_reqwest(auto_initial_5);var t=document.getElementById("buttonTextReplacer");t.style.display="block"}else roundNumber>1&&POST_reqwest(initial_5)}function auto_initial_5(e){initial_5(e),POST_reqwest(handlePlacements)}function initial_5(e){for(cards=JSON.parse(e),i=1;i<6;i++){var t=document.getElementById("place"+i+"card"),r=cards[i-1];t.src="../static/cards/"+r+".png",t.name=r,t.style.display="block"}var o=document.getElementById("playButton");o.onclick=function(){if(validateCardsPlaced()){vCardsId+=1,o.innerHTML="Next",o.style.display="none";var e=0;for(i=0;i<13;i++){var t=document.getElementById(player_positions[i]);t.hasChildNodes()&&3!=t.firstChild.nodeType&&(t.firstChild.ondragstart=function(){return!1},e+=1)}if(13==e&&"False"==playerFirst)return void POST_reqwest(handleRoundEnd);var r=document.getElementById("buttonTextReplacer");r.style.display="block",POST_reqwest(handlePlacements)}else alert("Please place all your cards first!")}}function handlePlacements(e){var r=JSON.parse(e);if(readAndPlace=function(e,o,a){for(i=e;i<o+1;i++)if(t=r.properties2.cards.items["position"+i],null!=t){if(j=i,"middle"==a?j-=5:"top"==a&&(j-=10),container=document.getElementById("p2_"+a+j),container.hasChildNodes()){if(3!=container.firstChild.nodeType)continue;container.removeChild(container.firstChild)}var n=document.createElement("img");n.src="../static/cards/"+t+".png",n.name=t,n.width=109,n.height=150,n.ondragstart=function(){return!1},console.log("AI Placed "+n.name+" in row "+a+" (position"+i+")"),container.appendChild(n)}},!("properties2"in r))return void POST_reqwest(handleRoundEnd);readAndPlace(1,5,"bottom"),readAndPlace(6,10,"middle"),readAndPlace(11,13,"top");var o=document.getElementById("playButton");o.style.display="block";var a=document.getElementById("buttonTextReplacer");for(a.style.display="none",cardsPlacedCount=0,i=0;i<14;i++)null!=r.properties1.cards.items["position"+i]&&(cardsPlacedCount+=1);if(cardsPlacedCount<13&&"cardtoplace"in r){var n=document.getElementById("place"+(cardsPlacedCount+1)+"card");n.src="../static/cards/"+r.cardtoplace+".png",n.name=r.cardtoplace,n.style.display="block"}else 13==cardsPlacedCount&&POST_reqwest(handleRoundEnd)}function validateCardsPlaced(){if(5==vCardsId)for(i=0;i<5;i++){var e=document.getElementById("place"+(i+1)+"card");if(e.parentNode.id=="place"+(i+1))return!1}else{var e=document.getElementById("place"+vCardsId+"card");if("place1"==e.parentNode.id)return!1}return!0}function handleRoundEnd(e){var t=document.getElementById("buttonTextReplacer");t.style.display="none",scores_obj=JSON.parse(e),p1_t_score=p1score,p2_t_score=p2score,p1_wins=0,p2_wins=0,p1foul=scores_obj[3][0],p2foul=scores_obj[3][1],1==scores_obj[0][0]?(net=scores_obj[0][1]-scores_obj[0][2]+1,rowScoresArr[0]=net,rowScoresArr[3]=-net,p1_wins+=1):2==scores_obj[0][0]&&(net=scores_obj[0][2]-scores_obj[0][1]+1,rowScoresArr[0]=-net,rowScoresArr[3]=net,p2_wins+=1),1==scores_obj[1][0]?(net=scores_obj[1][1]-scores_obj[1][2]+1,rowScoresArr[1]=net,rowScoresArr[4]=-net,p1_wins+=1):2==scores_obj[1][0]&&(net=scores_obj[1][2]-scores_obj[1][1]+1,rowScoresArr[1]=-net,rowScoresArr[4]=net,p2_wins+=1),1==scores_obj[2][0]?(net=scores_obj[2][1]-scores_obj[2][2]+1,rowScoresArr[2]=net,rowScoresArr[5]=-net,p1_wins+=1):2==scores_obj[2][0]&&(net=scores_obj[2][2]-scores_obj[2][1]+1,rowScoresArr[2]=-net,rowScoresArr[5]=net,p2_wins+=1),p1_t_score+=rowScoresArr[0]+rowScoresArr[1]+rowScoresArr[2],p2_t_score+=rowScoresArr[3]+rowScoresArr[4]+rowScoresArr[5],scoop=0,3==p1_wins?(p1_t_score+=3,p2_t_score-=3,scoop=1):3==p2_wins&&(p1_t_score-=3,p2_t_score+=3,scoop=2);var r,o,a=0;for(pID=1;pID<=2;pID++)for(rowID=3;rowID>=1;rowID--){o="p"+pID+"_text"+rowID,r=chooseScoreColour(rowScoresArr[a]);var n="";rowScoresArr[a]>0&&(n="+"),tempLabel=document.getElementById(o),tempLabel.innerHTML="<br />"+n+rowScoresArr[a],tempLabel.style.color=r,a++}playerLabels(p1_t_score,p2_t_score,scoop,p1foul,p2foul);var i=document.getElementById("playButton");i.innerHTML="Play next round",i.style.display="block",i.onclick=function(){window.location=window.location+"/next"}}function chooseScoreColour(e){return e>=0?"#00C303":"#FF0000"}function playerLabels(e,t,r,o,a){p1_label_tail="",p2_label_tail="",1==r?(p1_label_tail+=" + Scoop (3)!",e-=3):2==r&&(p2_label_tail+=" + Scoop (3)!",t-=3),1==o&&(p1_label_tail+=" Fouled!"),1==a&&(p2_label_tail+=" Fouled!");var n,i;n=player1+" ("+e+")"+p1_label_tail,i=player2+" ("+t+")"+p2_label_tail;var s=document.getElementById("p1label");s.innerHTML=n,s=document.getElementById("p2label"),s.innerHTML=i}function populate_game_state_arrays(){var e="",t="",r=[],o=[];for(i=0;i<13;i++){try{e=document.getElementById(player_positions[i]).childNodes[0].name,"undefined"==typeof e&&(e=null)}catch(a){e=null}try{t=document.getElementById(AI_positions[i]).childNodes[0].name,"undefined"==typeof t&&(t=null)}catch(a){t=null}r.push(e),o.push(t)}return[r,o]}function POST_reqwest(e){var t=populate_game_state_arrays();tarray1=t[0],tarray2=t[1],reqwest({url:"https://alastairkerr.co.uk/ofc/api/ofc-backend/",method:"post",data:{"game-id":gameId,"game-state":JSON.stringify({name1:"Player1",properties1:{cards:{type:"array",items:{position1:tarray1[0],position2:tarray1[1],position3:tarray1[2],position4:tarray1[3],position5:tarray1[4],position6:tarray1[5],position7:tarray1[6],position8:tarray1[7],position9:tarray1[8],position10:tarray1[9],position11:tarray1[10],position12:tarray1[11],position13:tarray1[12]}}},name2:"Player2",properties2:{cards:{type:"array",items:{position1:tarray2[0],position2:tarray2[1],position3:tarray2[2],position4:tarray2[3],position5:tarray2[4],position6:tarray2[5],position7:tarray2[6],position8:tarray2[7],position9:tarray2[8],position10:tarray2[9],position11:tarray2[10],position12:tarray2[11],position13:tarray2[12]}}}})}}).then(e).fail(function(e){astring="Error! POST 'Reqwest' unsuccessful... check server connection and try again.\n"+e.toString(),alert(astring)})}var suits=["h","d","s","c"],AI_positions=["p2_bottom1","p2_bottom2","p2_bottom3","p2_bottom4","p2_bottom5","p2_middle1","p2_middle2","p2_middle3","p2_middle4","p2_middle5","p2_top1","p2_top2","p2_top3"],player_positions=["p1_bottom1","p1_bottom2","p1_bottom3","p1_bottom4","p1_bottom5","p1_middle1","p1_middle2","p1_middle3","p1_middle4","p1_middle5","p1_top1","p1_top2","p1_top3"],rowScoresArr=[0,0,0,0,0,0],p1score=t_score,p2score=-t_score,player1="Player 1",player2="Computer Opponent",vCardsId=5;setupGame();